"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}window.CBC||(window.CBC={}),CBC=CBC||window.CBC,CBC.APP||(CBC.APP={}),CBC.APP.AB||(CBC.APP.AB={}),CBC.APP.ANA||(CBC.APP.ANA={}),CBC.APP.ANA.DISPATCHERS||(CBC.APP.ANA.DISPATCHERS={}),CBC.APP.ANA.DISPATCHERS.Amplitude||(CBC.APP.ANA.DISPATCHERS.Amplitude={}),CBC.APP.ANA.DISPATCHERS.FBPIXEL||(CBC.APP.ANA.DISPATCHERS.FBPIXEL={}),CBC.APP.ANA.DISPATCHERS.MirRoar||(CBC.APP.ANA.DISPATCHERS.MirRoar={}),CBC.APP.ANA.FORMATTERS||(CBC.APP.ANA.FORMATTERS={}),CBC.APP.ANA.FORMATTERS.Amplitude||(CBC.APP.ANA.FORMATTERS.Amplitude={}),CBC.APP.ANA.FORMATTERS.Common||(CBC.APP.ANA.FORMATTERS.Common={}),CBC.APP.ANA.FORMATTERS.MirRoar||(CBC.APP.ANA.FORMATTERS.MirRoar={}),CBC.APP.ANA.LIBRARY||(CBC.APP.ANA.LIBRARY={}),CBC.APP.ANA.LIBRARY.Amplitude||(CBC.APP.ANA.LIBRARY.Amplitude={}),CBC.APP.ANA.LIBRARY.FBPIXEL||(CBC.APP.ANA.LIBRARY.FBPIXEL={}),CBC.APP.ANA.VALIDATORS||(CBC.APP.ANA.VALIDATORS={}),CBC.APP.ANA.VALIDATORS.Amplitude||(CBC.APP.ANA.VALIDATORS.Amplitude={}),CBC.APP.ANA.VALIDATORS.Common||(CBC.APP.ANA.VALIDATORS.Common={}),CBC.APP.ANA.VALIDATORS.FBPIXEL||(CBC.APP.ANA.VALIDATORS.FBPIXEL={}),CBC.APP.ANA.VALIDATORS.MirRoar||(CBC.APP.ANA.VALIDATORS.MirRoar={}),CBC.APP.ANA.VARS||(CBC.APP.ANA.VARS={}),CBC.APP.ANA.WEBABTESTS||(CBC.APP.ANA.WEBABTESTS={}),CBC.APP.COMSCORE||(CBC.APP.COMSCORE={}),CBC.APP.CXENSE||(CBC.APP.CXENSE={}),CBC.APP.DMP||(CBC.APP.DMP={}),CBC.APP.DMP.LOTAME||(CBC.APP.DMP.LOTAME={}),CBC.APP.PubSub||(CBC.APP.PubSub={}),CBC.APP.readJS||(CBC.APP.readJS={}),CBC.APP.SC||(CBC.APP.SC={}),CBC.APP.SC.DTM||(CBC.APP.SC.DTM={}),CBC.APP.SC.DTM.DATA||(CBC.APP.SC.DTM.DATA={}),CBC.APP.SC.DTM.formatted||(CBC.APP.SC.DTM.formatted={}),CBC.APP.SC.EventTracker||(CBC.APP.SC.EventTracker={}),CBC.APP.ANA.LinkTracker||(CBC.APP.ANA.LinkTracker={}),CBC.APP.SC.LOCALGEO||(CBC.APP.SC.LOCALGEO={}),CBC.APP.SC.masterSwitch||(CBC.APP.SC.masterSwitch={}),CBC.APP.SC.metadataWhitelist||(CBC.APP.SC.metadataWhitelist={}),CBC.APP.SC.PageTracker||(CBC.APP.SC.PageTracker={}),CBC.APP.SC.Subscribers||(CBC.APP.SC.Subscribers={}),CBC.APP.SC.UTIL||(CBC.APP.SC.UTIL={}),CBC.APP.versions||(CBC.APP.versions={}),CBC.APP.versions["cbc-stats-bottom"]="2.76.0",CBC.APP.SC.Detectizr=function(e){var t=e||(window.navigator.userAgent||window.navigator.vendor||window.opera).toLowerCase();function a(e){return e.test(t)}function r(e){return-1<t.indexOf(e)}function n(e){return e.exec(t)}function i(e,t){var a=(e.version=t).split(".");0<a.length?(a=a.reverse(),e.major=a.pop(),0<a.length?(e.minor=a.pop(),0<a.length?(a=a.reverse(),e.patch=a.join(".")):e.patch="0"):e.minor="0"):e.major="0"}var o={type:"",model:""},s={},c=["tv","tablet","mobile","desktop"];return a(/googletv|smarttv|smart-tv|internet.tv|netcast|nettv|appletv|boxee|kylo|dlnadoc|roku|pov_tv|hbbtv|ce-html/)?(o.type=c[0],o.model="smartTv"):a(/xbox|playstation.3|wii/)?(o.type=c[0],o.model="gameConsole"):a(/ip(a|ro)d/)?(o.type=c[1],o.model="ipad"):a(/tablet/)&&!a(/rx-34/)||a(/folio/)?(o.type=c[1],o.model=String(n(/playbook/)||"")):a(/linux/)&&a(/android/)&&!a(/fennec|mobi|htc.magic|htcX06ht|nexus.one|sc-02b|fone.945/)?(o.type=c[1],o.model="android"):a(/kindle/)||a(/mac.os/)&&a(/silk/)?(o.type=c[1],o.model="kindle"):a(/gt-p10|sc-01c|shw-m180s|sgh-t849|sch-i800|shw-m180l|sph-p100|sgh-i987|zt180|htc(.flyer|_flyer)|sprint.atp51|viewpad7|pandigital(sprnova|nova)|ideos.s7|dell.streak.7|advent.vega|a101it|a70bht|mid7015|next2|nook/)||a(/mb511/)&&a(/rutem/)?(o.type=c[1],o.model="android"):a(/bb10/)?(o.type=c[1],o.model="blackberry"):(o.model=n(/iphone|ipod|android|blackberry|opera mini|opera mobi|skyfire|maemo|windows phone|palm|iemobile|symbian|symbianos|fennec|j2me/),null!==o.model?(o.type=c[2],o.model=String(o.model)):(o.model="",a(/bolt|fennec|iris|maemo|minimo|mobi|mowser|netfront|novarra|prism|rx-34|skyfire|tear|xv6875|xv6975|google.wireless.transcoder/)?o.type=c[2]:a(/opera/)&&a(/windows.nt.5/)&&a(/htc|xda|mini|vario|samsung-gt-i8000|samsung-sgh-i9/)?o.type=c[2]:a(/windows.(nt|xp|me|9)/)&&!a(/phone/)||a(/win(9|.9|nt)/)||a(/\(windows 8\)/)?o.type=c[3]:a(/macintosh|powerpc/)&&!a(/silk/)?(o.type=c[3],o.model="mac os"):a(/cros/)?o.type=c[3]:o.type=c[2])),""!==o.model&&("ipad"===o.model||"iphone"===o.model||"ipod"===o.model?(s.name="ios",i(s,(a(/os\s([\d_]+)/)?RegExp.$1:"").replace(/_/g,"."))):"android"===o.model?(s.name="android",i(s,a(/android\s([\d.]+)/)?RegExp.$1:"")):"blackberry"===o.model?(s.name="blackberry",i(s,a(/version\/([^\s]+)/)?RegExp.$1:"")):"playbook"===o.model&&(s.name="blackberry",i(s,a(/os ([^\s]+)/)?RegExp.$1.replace(";",""):""))),s.name||(r("win")||r("16bit")?(s.name="windows",r("windows nt 10")?i(s,"10"):r("windows nt 6.3")?i(s,"8.1"):r("windows nt 6.2")||a(/\(windows 8\)/)?i(s,"8"):r("windows nt 6.1")?i(s,"7"):r("windows nt 6.0")?i(s,"vista"):(r("windows nt 5.2")||r("windows nt 5.1")||r("windows xp"))&&i(s,"xp")):r("mac")||r("darwin")?(s.name="mac os",r("os x")&&i(s,(a(/os\sx\s([\d_]+)/)?RegExp.$1:"os x").replace(/_/g,"."))):r("webtv")?s.name="webtv":(r("x11")||r("inux"))&&(s.name="linux")),{os:s,device:o,ua:t}},window.Detectizr=CBC.APP.SC.Detectizr(),function(){if(!Object.keys(CBC.APP.PubSub).length){var e=function(){function r(e,t,a){_classCallCheck(this,r),this.subscribers=e||{},this.queuedEvents=t||[],this.isOn=a||!1}return _createClass(r,[{key:"turnOn",value:function(){if(this.isOn=!0,this.queuedEvents.length)for(var e=0;e<this.queuedEvents.length;e++)this.publish(this.queuedEvents[e].event,this.queuedEvents[e].payload),this.queuedEvents.splice(e,1)}},{key:"turnOff",value:function(){this.isOn=!1}},{key:"isOn",value:function(){return this.isOn}},{key:"publish",value:function(t,a){t in this.subscribers?this.subscribers[t].slice().forEach(function(e){try{e(t,a)}catch(e){console.error(e.message)}}):this.isOn||this.queuedEvents.push({event:t,payload:a})}},{key:"subscribe",value:function(e,t){return e in this.subscribers||(this.subscribers[e]=[]),this.subscribers[e].some(function(e){if(t===e)return!0})?(console.log("callback already exists for event:",e,t),!1):(this.subscribers[e].push(t),!0)}},{key:"unsubscribe",value:function(e,r){e in this.subscribers&&this.subscribers[e].some(function(e,t,a){if(r===e)return a.splice(t,1),!0})}}]),r}();CBC.APP.PubSub=new e}}(),CBC.APP.SC.viafouraSubscribed=!1,function(){function e(){CBC.APP.SC.viafouraSubscribed||(CBC.APP.SC.DEBUG&&console.log("Subscribing to Viafoura events"),window.vf.$subscribe("share","clicked",function(e,t){var a={network:e,elem:t};CBC.APP.SC.EventTracker.trackEvent("SHARED",a)}),window.vf.$subscribe("logout","success",function(){CBC.APP.SC.EventTracker.trackEvent("SIGNED OUT",{})}),window.vf.$subscribe("login","success",function(e){e&&1==e.isNewUser?CBC.APP.SC.EventTracker.trackEvent("SIGNED IN",{feature:{name:"sign-up-form"}}):CBC.APP.SC.EventTracker.trackEvent("SIGNED IN",{})}),window.vf.$subscribe("comment","created",function(e){CBC.APP.SC.EventTracker.trackEvent("COMMENTED",{})}),window.vf.$subscribe("comment-reply","posted",function(e){CBC.APP.SC.EventTracker.trackEvent("COMMENTED",{})}),CBC.APP.SC.viafouraSubscribed=!0,CBC.APP.PubSub.publish("viafouraAvailable",{}))}void 0!==window.vf?e():(window.vfQ=window.vfQ||[],window.vfQ.push(e)),CBC.APP.PubSub.subscribe("loadedAudiences",function e(t,a){if(Array.isArray(a)&&a.length){var r=a.filter(function(e){return e.id}).map(function(e){return e.id});0<r.length&&(CBC.APP.ANA.FORMATTERS.Amplitude.mUP("set","user.segments.dmp.ids",r),CBC.APP.PubSub.unsubscribe("loadedAudiences",e))}})}(),function(){function e(e){var t=e=e.replace(":","");try{for(var a=0;a<100&&t!=(e=decodeURIComponent(e))&&!e.match(/^http(s)?\:/);a++)t=e}catch(e){}return e.replace(/(^\s+|\s+$)/g,"")}try{var i=function(e,t,a,r){return e[t]===r&&0===a||e[a]===r&&0===t};if(!location||!location.hostname||!location.pathname)return;var t,a,r,n,o=document.location.hostname.replace(/^www\./,""),s=function(){for(var e,t,a=document.getElementsByTagName("meta"),r=0,n=a.length;r<n;r++)if("og:title"===(t=a[r]).getAttribute("property")){e=t.getAttribute("content");break}return e=e||(document.title||"Untitled")}(),c=(y=s,(B=c={}).l1=o,B.l2=y,B.l3="__page__",B.l4="-",B),u=(new Date).getTime(),l=Math.floor(Math.random()*Math.pow(10,12));t=(a=function(){for(var e=[64],t=1;t<=3;t++)e.push(64+t),e.push(64-t);return{b:e=e[Math.floor(Math.random()*e.length)],a:0==Math.floor(Math.random()*e)}}()).a?a.b:0,c.zmoatab_cm=t,c.t=u,c.de=l,c.zMoatAB_SNPT=!0,r=t||1,n=!a||!!a.a;o=[];var d,C=(new Date).getTime().toString(35),p=[e(c.l1),e(c.l2),e(c.l3),e(c.l4)].join(":"),h=(s=/zct[a-z0-9]+/i,"");for(d in c)c.hasOwnProperty(d)&&d.match(s)&&(h+="&"+d+"="+c[d]);var A=document.referrer.match(/^([^:]{2,}:\/\/[^\/]*)/),P=A?A[1]:document.referrer,g=["e=17","d="+encodeURIComponent(p),"de="+l,"t="+u,"i=CBCCONTENT2","cm="+r,String("j="+encodeURIComponent(P)+h),"mp=1","ac=1","pl=1","bq=10","vc=2"],m=(C="https://5j8ujmnywdoc-a.akamaihd.net/"+C+".gif?")+(m=function(e){for(var t="",a=0;a<e.length;a++)t+=(0===a?"":"&")+e[a];return t}(function(e){for(var t=0;t<e.length;t++){var a=Math.floor(Math.random()*(e.length-t)+t),r=e[t],n=i(e,t,a,g[1]);i(e,t,a,g[0])||n?t--:(e[t]=e[a],e[a]=r)}return e}(g)))+"&cs=0",b="https://px.moatads.com/pixel.gif?e=17&d="+encodeURIComponent(p)+"&de="+l+"&t="+u+"&i=CBCCONTENT2&cm="+r+"&j="+encodeURIComponent(P)+h+"&mp=0&ac=1&pl=1&bq=10&ad_type=img&vc=2&cs=0",f="https://px.moatads.com/pixel.gif?e=17&d="+encodeURIComponent(p)+"&de="+l+"&t="+u+"&i=CBCCONTENT2&cm="+r+"&j="+encodeURIComponent(P)+h+"&ku=1&ac=1&pl=1&bq=10&ad_type=img&vc=2&cs=0";for(var v in n&&((new Image).src=m,(new Image).src=b),c)o.push(v+"="+encodeURIComponent(c[v]));o=(o=o.join("&"))+"&vc=2";var S=document.createElement("script");S.type="text/javascript",S.async=!0,n&&(S.onerror=function(){(new Image).src=f});var T=document.getElementsByTagName("script")[0];T.parentNode.insertBefore(S,T),S.src="https://z.moatads.com/cbc907UvMO43/moatcontent.js#"+o}catch(e){try{var w="//pixel.moatads.com/pixel.gif?e=24&d=data%3Adata%3Adata%3Adata&i=MOATCONTENTABSNIPPET1"+h+"&vc=2&ac=1&k="+encodeURIComponent(e)+"&j="+encodeURIComponent(P)+"&cs="+(new Date).getTime();(new Image).src=w}catch(e){}}var B,y}(),window._sf_endpt=(new Date).getTime(),CBC.APP.COMSCORE={useBeacon:!1,payload:{c1:2,c2:3005684},dataStructure:{},Call:function(){if(CBC.APP.SC.DTM.formatted.comscore&&(this.dataStructure=CBC.APP.SC.DTM.formatted.comscore),this.useBeacon)this.pvCandidate();else{this.useBeacon=!0;var e="",t={};if(Object.keys(this.dataStructure).length){if(this.dataStructure.syndicate&&"gamp"===this.dataStructure.syndicate)return!1;e=this.getC6(),t=this.getOptions()}var a={c3:"",c4:escape(window.location.href),c5:"CBC.ca-CanadianNewsSportsEntertainmentKidsDocsRadioTV",c6:e,c15:"",options:t},r=window._comscore||[];r.push(this.generatePayload(a,this.payload)),window._comscore=r,this.pvCandidate();var n=document.createElement("script"),i=document.getElementsByTagName("script")[0];n.async=!0,n.src="https://sb.scorecardresearch.com/beacon.js",i&&i.parentNode.insertBefore(n,i)}},getC6:function(){var e="";return this.dataStructure.subsection3?e=this.dataStructure.subsection3:this.dataStructure.subsection2?e=this.dataStructure.subsection2:this.dataStructure.subsection1&&(e=this.dataStructure.subsection1),e},getOptions:function(){var e={};if(this.dataStructure.syndicate&&"fia"===this.dataStructure.syndicate)e={url_append:"comscorekw=fbia"};else if(this.useBeacon&&this.dataStructure.contentarea&&"homepage"!==this.dataStructure.contentarea){var t=this.dataStructure.contentarea,a=this.dataStructure.subsection1,r=t;"news"===t&&a&&(r=a),e={url_append:"comscorekw=".concat(r)}}if(document.getElementById("comscore-comment-div")&&document.getElementById("comscore-comment-div").remove(),e.url_append){var n=document.createElement("div"),i=document.createComment("comScore Identifier: ".concat(e.url_append));n.id="comscore-comment-div",n.appendChild(i),document.body.appendChild(n)}return e},generatePayload:function(e,t){return Object.assign({},e,t)},pvCandidate:function(){var e=this.getOptions();window.COMSCORE&&window.COMSCORE.beacon(this.generatePayload(this.payload,{options:e}));var t=void 0!==e.url_append?e.url_append+"&":"";CBC.APP.SC.UTIL.makeGETRequest("//www.cbc.ca/g/stats/comscore.json?".concat(t,"cache=").concat((new Date).getTime()),{success:function(e,t){JSON.parse(e.responseText).comscore||console.log("COMSCORE-bottom: json response error")},failure:function(e,t){console.log("COMSCORE-bottom: json request error")}},{success:{success:!0},failure:{success:!1}})}},Object.keys(CBC.APP.CXENSE).length||(CBC.APP.CXENSE={addMetaTags:function(){for(var e=document.querySelectorAll("meta[name^=cXenseParse]"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);var a,r=CBC.APP.SC.DTM.formatted.cxense,n=document.querySelector("head");if(r&&r.contenttype){var i="article";"index"===r.contenttype&&(i="frontpage",r.contentarea&&["video","kids","tv"].includes(r.contentarea.toLowerCase())&&(i="article","video"!==r.contentarea||r.contentid||(i="frontpage"),r.subsection1&&["index","search"].includes(r.subsection1.toLowerCase())&&(i="frontpage")));var o=this.createMetaTag("cXenseParse:","pageclass",i);n.appendChild(o)}if(r&&r.contenttype&&"index"===r.contenttype&&r.contentarea&&["video","kids","tv","life"].includes(r.contentarea.toLowerCase()))if(r.pillar&&"legacyee"===r.pillar){a=r.subsection2?r.subsection2.replace(/[^a-zA-Z0-9"]/g," "):"",a+=r.subsection3&&"home"!==r.subsection3?" "+r.subsection3.replace(/[^a-zA-Z0-9"]/g," "):"";var s=this.createMetaTag("cXenseParse:","cbc-keymatch",a);n.appendChild(s)}else if("video"===r.contentarea&&r.contentid){a=r.subsection3?r.subsection3.replace(/[^a-zA-Z0-9"]/g," "):"";var c=this.createMetaTag("cXenseParse:","cbc-keymatch",a);n.appendChild(c)}for(var u in r)if({}.hasOwnProperty.call(r,u)){var l=this.createMetaTag("cXenseParse:cbc-",u,r[u]);if(n.appendChild(l),"publishedTime"===u&&!isNaN(parseInt(r[u]))){var d=this.createMetaTag("article:","published_time",new Date(parseInt(r[u])).toISOString(),"property");n.appendChild(d)}if("updatedTime"===u&&!isNaN(parseInt(r[u]))){var C=this.createMetaTag("article:","modified_time",new Date(parseInt(r[u])).toISOString(),"property");n.appendChild(C)}}},createMetaTag:function(e,t,a,r){var n=3<arguments.length&&void 0!==r?r:"name",i=document.createElement("meta");return i.setAttribute(n,e+t),i.setAttribute("content",a),i},pageView:function(){CBC.APP.CXENSE.addMetaTags(),window.cX.callQueue.push(["sendPageViewEvent"])}}),function(){var e,t,a,r;window.cX=window.cX||{},window.cX.callQueue=window.cX.callQueue||[],window.cX.callQueue.push(["setSiteId","9222369215399074873"]),e=document,t="script",(a=e.createElement(t)).type="text/java"+t,a.async="async",a.src="https://scdn.cxense.com/cx.js",(r=e.getElementsByTagName(t)[0])&&r.parentNode.insertBefore(a,r)}(),function(){function a(r,n){if(void 0!==CBC.APP.SC.DTM.formatted.googlecloud&&(n=CBC.APP.SC.DTM.formatted.googlecloud),"READ"===r.toUpperCase()&&n&&n.content&&(!n.content.id||"comments"===n.content.type))return!1;function c(a,r,n,e){if(!n.content.id)return!1;var i=e,o=(new Map).set(500,!0).set(502,!0).set(503,!0).set(504,!0),t=(new Map).set("READ",["Read","E0406C","PolopolyArticle",n.content.id]).set("WATCHED",["Watched","WATCHED_PREDICATE_ID","MPXVideo","Replace_With_MPX_Video_ID"]).set("LISTENED",["Listened","LISTENED_PREDICATE_ID","AudioDB","Replace_With_AudioDB_ID"]),s={subject:{}};return s.subject.type="User",s.subject.id=u||l,!!s.subject.id&&(s.predicate={},s.predicate.type=t.get(r.toUpperCase())[0],s.predicate.id=t.get(r.toUpperCase())[1],s.predicate.end=(new Date).toISOString(),s.object={},s.object.type=t.get(r.toUpperCase())[2],s.object.id=t.get(r.toUpperCase())[3],!(!JSON.stringify(s)||"{}"===JSON.stringify(s))&&void CBC.APP.SC.UTIL.makePOSTRequest(a,JSON.stringify(s),{success:function(e,t){},failure:function(e,t){o.has(e.status)&&i<3?(++i,setTimeout(function(){c(a,r,n,i)},2e3)):o.has(e.status)&&3<=i?(console.log("ERROR: ESS Server too busy or overloaded."),console.log("    URL: "+t.failure.uri),console.log("    Payload: "+JSON.stringify(t.failure.payload))):400===e.status?(console.log("ERROR: Missing or malformed ESS Payload."),console.log("    Payload: "+JSON.stringify(t.failure.payload))):(console.log("ERROR: Unable to talk to ESS Enpoint."),console.log("    URL: "+t.failure.uri))}},{success:{uri:a},failure:{payload:s,uri:a}},null,{"Content-Type":"application/json"}))}function i(e,t,a){(a=a||{}).user||(a.user={}),a.session||(a.session={}),a.verb=t,l&&(a.user.cbc_visitor=l),u&&(a.user.cbc_plus=u),a.session.startTime=CBC.APP.SC.EventTracker.sessionStartTime,CBC.APP.SC.UTIL.makePOSTRequest(e,JSON.stringify(a),{success:function(e,t){},failure:function(e){console.log("ERROR: Unable to talk to RecSys URL: "+e.failure.uri)}},{success:{uri:e},failure:{uri:e}},null,{"Content-Type":"application/json"})}var u=CBC.APP.SC.UTIL.getCookie("cbc_plus"),l=CBC.APP.SC.UTIL.getCookie("cbc_visitor");try{CBC.APP.SC.masterSwitch.switches.googlecloud&&(/ess/.test(CBC.APP.SC.masterSwitch.googlecloud.url)?c(CBC.APP.SC.masterSwitch.googlecloud.url,r,n,0):i(CBC.APP.SC.masterSwitch.googlecloud.url,r,n))}catch(e){var t="//www.cbc.ca/network/includes/stats/master-switch.json";CBC.APP.SC.UTIL.makeGETRequest(t,{success:function(e,t){var a=JSON.parse(e.responseText);a.switches.googlecloud&&(/ess/.test(a.googlecloud.url)?c(a.googlecloud.url,r,n,0):i(a.googlecloud.url,r,n))},failure:function(e,t){console.log("ERROR: Unable to talk to config URL: "+t.failure.uri)}},{success:{uri:t},failure:{uri:t}})}}function r(e,t){void 0!==CBC.APP.SC.DTM.formatted.googlecloud&&"READ"==e&&(t=CBC.APP.SC.DTM.formatted.googlecloud),"STREAMED"===e&&t.content?"video"===t.content.area||t.content.media&&"video"===t.content.media.audiovideo?window.CBC.APP.AB.Testing.sendGoal("api-streamed-video",1):("audio"===t.content.area||t.content.media&&"audio"===t.content.media.audiovideo)&&window.CBC.APP.AB.Testing.sendGoal("api-streamed-audio",1):"READ"===e&&t.content&&"comments"===t.content.type&&window.CBC.APP.AB.Testing.sendGoal("api-read-comment",1)}CBC.APP.PubSub.subscribe("SIGNED IN",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),CBC.APP.SC.DTM.DATA.authenticated=CBC.APP.SC.PageTracker.isLoggedIn(),CBC.APP.SC.UTIL.setFormattedLayer(),CBC.APP.SC.UTIL.sendDataToUIE(t)}),CBC.APP.PubSub.subscribe("SIGNED OUT",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),CBC.APP.SC.DTM.DATA.authenticated=CBC.APP.SC.PageTracker.isLoggedIn(),CBC.APP.SC.UTIL.setFormattedLayer(),CBC.APP.SC.UTIL.removeCBCPlusID(),CBC.APP.SC.UTIL.sendDataToUIE(t)}),CBC.APP.PubSub.subscribe("READ",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),r("READ",{}),a("READ",t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("STREAMED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),r("STREAMED",t),CBC.APP.SC.UTIL.sendDataToUIE(t)}),CBC.APP.PubSub.subscribe("SUBSCRIBED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),CBC.APP.SC.UTIL.sendDataToUIE(t)}),CBC.APP.PubSub.subscribe("UNSUBSCRIBED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t),CBC.APP.SC.UTIL.sendDataToUIE(t)})}(),CBC.APP.PubSub.subscribe("CLOSED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("COMMENTED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("LISTENED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("LOADED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("LOADED MORE",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("NEXT",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("OPENED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("PLAYED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("PREVIOUS",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SEARCHED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SELECTED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SET PREFERENCE",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SHARED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("START WEB SESSION",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("SUBMITTED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("UIEAlert",function(){CBC.APP.ANA.VALIDATORS.FBPIXEL.setUserStatusPromise()}),CBC.APP.PubSub.subscribe("VIEWED AD",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.PubSub.subscribe("WATCHED",function(e,t){CBC.APP.ANA.VALIDATORS.Amplitude.trackEvent(e,t),CBC.APP.ANA.VALIDATORS.MirRoar.trackEvent(e,t)}),CBC.APP.ANA.VALIDATORS.Amplitude=function(){function a(e,t){if(CBC.APP.SC.masterSwitch.switches.amplitude)return CBC.APP.ANA.LIBRARY.Amplitude.isInitialized()&&CBC.APP.ANA.LIBRARY.Amplitude.isOn()?CBC.APP.ANA.FORMATTERS.Amplitude.formatSignal(e,t):(r.push([e,t]),function(e){CBC.APP.SC.DEBUG&&"undefined"!=typeof console&&"function"==typeof console.log&&console.log(e)}("EventTracker - Warning: Amplitude is not turned on or initialized but the tracked events have been queued: "+e+" "+t),!1)}var r=[];return{trackEvent:function(e,t){if(null!=CBC.APP.SC.masterSwitch.switches.amplitude)return a(e,t);CBC.APP.SC.UTIL.masterSwitchMetaPromise().then(function(){return a(e,t)})},executeQueue:function(){if(CBC.APP.ANA.FORMATTERS.Amplitude.executeUPQueue(),r.length){for(var e=0;e<r.length;e++)a(r[e][0],r[e][1]);r=[]}}}}(),CBC.APP.ANA.VALIDATORS.Common={validateAppName:function(e){return CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.app.name[e]},getFeatureNameRegex:function(){return["^tab\\.(\\w+-?\\w*)+$","^tab\\.(\\w+-?\\w*)+\\.card$","^tab\\.(\\w+-?\\w*)+\\.card\\.label$","^category\\.list\\.card$","^tab\\.sections\\.list$","^tab\\.sections\\.regions\\.list$","^tab\\.sections\\.list\\.card$","^tab\\.sections\\.regions\\.list\\.card$","^tab\\.local\\.editors-picks\\.\\b(\\w*[-]?\\w*)\\b$","^tab\\.local\\.pub-time\\$*","^search$","^tab\\.(\\w+-?\\w*)+\\.(\\w+-?\\w*)+\\.card$","^deeplink\\.(notification|widget|url|search)$","^story\\.(leadmedia|leadgallery|leadimage|similarlink|hyperlink|relatedlink|photogallery|image)$","^tab\\.(\\w+-?\\w*)+\\.content-package\\.(main-visual|title|link-[\\d]+)$","^tab\\.(\\w+-?\\w*)+\\.(\\w+-?\\w*)+\\.more$"]},validatePlayedContentType:function(e){return!(e.event_properties&&e.event_properties.content&&"game"!==e.event_properties.content.type||e.content&&"game"!==e.content.type)}},CBC.APP.ANA.VALIDATORS.FBPIXEL=function(){var r=void 0;return{restrictKidsURL:function(){return/(cbc)?kids(cbc2|news|fantasyhockey)?/.test(CBC.APP.SC.UTIL.returnURL())},validateFacebookLibrary:function(){CBC.APP.SC.UTIL.masterSwitchMetaPromise().then(function(e){e.switches.facebook&&!CBC.APP.ANA.VALIDATORS.FBPIXEL.restrictKidsURL()?CBC.APP.ANA.LIBRARY.FBPIXEL.facebookLibrary():CBC.APP.SC.UTIL.console("Facebook has not been initialized on this page.")})},validatePageAndOptInPromise:function(){return new Promise(function(e,t){return window.fbq&&!CBC.APP.ANA.VALIDATORS.FBPIXEL.restrictKidsURL()?void 0===CBC.APP.ANA.VALIDATORS.FBPIXEL.checkOptIn()?CBC.APP.ANA.VALIDATORS.FBPIXEL.setUserStatusPromise().then(function(){return e(CBC.APP.ANA.VALIDATORS.FBPIXEL.checkOptIn())}).catch(function(e){CBC.APP.SC.UTIL.debug(e)}):e(Boolean(CBC.APP.ANA.VALIDATORS.FBPIXEL.checkOptIn())):e(!1)})},getUserFlagPromise:function(){var e=CBC.APP.SC.UTIL.getCookie("cbc_plus"),t=CBC.APP.SC.UTIL.getCookie("cbc_visitor"),r="https://ups.data.cbc.ca/v0/UIEUser/"+(e.length?e:t)+"/UPSPreferences/fdfc9e";return new Promise(function(t,a){CBC.APP.SC.UTIL.makeGETRequest(r,{success:function(e){t(e)},failure:function(e,t){a(t.failure.message)}},{failure:{message:"unable to communicate"}})})},setUserStatusPromise:function(){return new Promise(function(a,t){CBC.APP.ANA.VALIDATORS.FBPIXEL.getUserFlagPromise().then(function(e){var t=JSON.parse(e.response);r=void 0===t.fbpixel_tracking||t.fbpixel_tracking,a(!0)}).catch(function(e){t(e)})})},checkOptIn:function(){return r}}}(),CBC.APP.ANA.VALIDATORS.FBPIXEL.validateFacebookLibrary(),CBC.APP.ANA.VALIDATORS.MirRoar=function(){function a(e,t){if(CBC.APP.SC.masterSwitch.switches.MirRoar)return CBC.APP.ANA.FORMATTERS.MirRoar.formatSignal(e,t)}return{trackEvent:function(e,t){null==CBC.APP.SC.masterSwitch.switches.MirRoar?CBC.APP.SC.UTIL.masterSwitchMetaPromise().then(function(){a(e,t)}):a(e,t)}}}(),CBC.APP.ANA.DISPATCHERS.Amplitude={dispatch:function(e,t){window.amplitude.getInstance("stats").logEvent(e,t)}},CBC.APP.ANA.DISPATCHERS.FBPIXEL={pageView:function(){CBC.APP.ANA.VALIDATORS.FBPIXEL.validatePageAndOptInPromise().then(function(e){e&&fbq("trackCustom","LOADED")}).catch(function(e){CBC.APP.SC.UTIL.debug(e)})}},CBC.APP.ANA.DISPATCHERS.MirRoar={dispatch:function(e){CBC.APP.SC.UTIL.makePOSTRequest("https://us-central1-digitalproducts-gabbo.cloudfunctions.net/web_streaming_prod",JSON.stringify(e),{success:function(e,t){},failure:function(e,t){}},{success:{uri:"https://us-central1-digitalproducts-gabbo.cloudfunctions.net/web_streaming_prod"},failure:{payload:e,uri:"https://us-central1-digitalproducts-gabbo.cloudfunctions.net/web_streaming_prod"}},null,{"Content-Type":"application/json"})}},function(){function u(e,t){_classCallCheck(this,u),this.type=e,this.value=t}var i={watch:!0,live:!0,betalisten:!0,gem:!0},o={artists:!0},p=function(){function r(e){var a=this;_classCallCheck(this,r),this.hostname="",this.pathname="",this.path=[],this.query="",this.params={},this.fragment="",this.productHostName=null,e=(e=e||"").toLowerCase();var t=document.createElement("a");t.href=e,t.hostname&&(this.hostname=t.hostname.replace(/^www\./,"")),t.pathname&&(this.pathname=t.pathname,this.path=t.pathname.split("/").filter(Boolean)),t.hash&&(this.fragment=t.hash.replace(/^#/,"")),t.search&&(this.query=t.search.substr(1),this.query.split("&").forEach(function(e){var t=e.split("=");a.params[t[0]]=decodeURIComponent(t[1])}))}return _createClass(r,[{key:"getProductHostName",value:function(){if(null!=this.productHostName)return this.productHostName;this.productHostName=this.hostname||"";var e=this.hostname.split("."),t=null,a=null,r=null;if(2<=e.length&&(t=e[e.length-1],a=e[e.length-2],3<=e.length&&(r=e[0])),"ca"!==t)return this.productHostName;var n=null;if("cbc"===a)n=i;else{if("cbcmusic"!==a)return this.productHostName;n=o}return this.productHostName=n[r]?"".concat(r,".").concat(a,".").concat(t):"".concat(a,".").concat(t),this.productHostName}}],[{key:"getLocationUrl",value:function(){return window.location.href}}]),r}();u.TYPES={INTEREST:"int",GENERIC_PROPERTY:"genp",CUSTOM_SEGMENT:"seg",ACTION:"act",MEDIA:"med",GENERIC_GEO:"geo",GENERIC_DEMO:"dem",SITEMAPS:"sm",ADVERTISER:"adv"};var s=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"spa",get:function(){return!0===(window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.spa)}},{key:"keywords",get:function(){var e=window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.keywords;return void 0===e?null:e}},{key:"contentType",get:function(){return window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.contenttype||""}},{key:"url",get:function(){var e=window.CBC.APP.SC.DTM.formatted&&window.CBC.APP.SC.DTM.formatted.lotame&&window.CBC.APP.SC.DTM.formatted.lotame.url;return(e=e||p.getLocationUrl())||""}},{key:"userTier",get:function(){return window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.userTier||""}},{key:"grapeshotCategories",get:function(){return window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.grapeshotCategories||[]}},{key:"grapeshotKeywords",get:function(){return window.CBC.APP.SC.DTM.DATA&&window.CBC.APP.SC.DTM.DATA.grapeshotKeywords||[]}}]),e}(),a=function(){function a(e){var t=e.logger;_classCallCheck(this,a),this.logger=t}return _createClass(a,[{key:"listSubPaths",value:function(e,t){var a=1<arguments.length&&void 0!==t?t:" : ",r=[],n=e.path.slice(0);if(-1!==e.fragment.indexOf("/")){var i=e.fragment.split("/").filter(Boolean);0<i.length&&(n=[].concat(_toConsumableArray(n),["#"],_toConsumableArray(i)))}var o=[];return n.forEach(function(e){o.push(e),"#"!==e&&r.push(o.join(a))}),r}},{key:"buildPageChangeBehaviours",value:function(e,t,a,r,n){var i=this.buildSiteTrafficBehaviours(e),o=this.buildSiteSectionBehaviours(e,t),s=[],c=[];"story"===t&&(s=this.buildKeywordBehaviours(a),c=this.buildGrapeshotBehaviours(r,n));var u=this.buildTimestampBehaviours("Page View"),l=new p(p.getLocationUrl()),d=this.buildCampaignReferralBehaviours(l),C=[];return t&&"index"===t&&(C=this.buildLandingPageBehaviours(e)),[].concat(i,o,s,c,u,d,C)}},{key:"buildSiteTrafficBehaviours",value:function(e){var t=e?e.getProductHostName():"";return[new u(u.TYPES.INTEREST,"".concat(t," : Total Site Traffic"))]}},{key:"buildSiteSectionBehaviours",value:function(e,t){var a=[],r=e?e.getProductHostName():"",n="".concat(r," : Site Section");if(0===e.path.length)a.push(new u(u.TYPES.INTEREST,"".concat(n," : homepage")));else for(var i=this.listSubPaths(e),o=0;o<i.length;o++){var s=u.TYPES.INTEREST;o===i.length-1&&t&&"index"!==t&&(s=u.TYPES.MEDIA),a.push(new u(s,"".concat(n," : ").concat(i[o])))}return a}},{key:"buildLandingPageBehaviours",value:function(e){var t=[],a=e?e.getProductHostName():"",r="".concat(a," : Landing Page");if(0<e.path.length){var n=this.listSubPaths(e);t.push(new u(u.TYPES.MEDIA,"".concat(r," : ").concat(n[n.length-1])))}return t}},{key:"buildSubjectKeywordBehaviours",value:function(t){var r=["Demographic Group","Demographic groups","Child and teen health","Sexual and reproductive health","Death and dying","Diagnosis and treatment","Diseases and conditions","Eye health","Heart health","Men's health","Women's health","Mental health","Oral health","Injuries","Seniors' health"],n=["cancer"],a={"&#39;":"'","&#x27;":"'"},i=[],o=u.TYPES.GENERIC_PROPERTY;if("entities"in t&&t.entities instanceof Array)for(var s=0;s<t.entities.length;s++){var c="Keyword : Subject";if(t.entities[s].name=t.entities[s].name.replace(new RegExp(Object.keys(a).join("|"),"g"),function(e){return a[e]}),t.entities[s].name)if("continue"===function(){var a=t.entities[s].name.split("/").filter(Boolean);if(r.some(function(e){return a.includes(e)})||n.some(function(t){return a.some(function(e){return e.includes(t)})}))return"continue";for(var e=0;e<a.length;e++)c+=" : "+a[e],-1===i.indexOf(c)&&i.push(c)}())continue}return i.map(function(e){return new u(o,e)})}},{key:"buildKeywordBehaviours",value:function(e){var t=[],a=u.TYPES.GENERIC_PROPERTY;if(e instanceof Array)for(var r=0;r<e.length;r++){var n=e[r].name,i="Keyword : "+n;if("Subject"===n){var o=this.buildSubjectKeywordBehaviours(e[r]);t=t.concat(o)}else if("entities"in e[r]&&e[r].entities instanceof Array)for(var s=0;s<e[r].entities.length;s++){var c=i+" : "+e[r].entities[s].name;t.push(new u(a,c))}}return t}},{key:"buildGrapeshotBehaviours",value:function(e,t){function a(a){return function(e,t){return t&&e.push(new u(u.TYPES.ADVERTISER,"grapeshot : ".concat(a," : ").concat(t.trim()))),e}}var r=[];return e.reduce(a("category"),r),t.reduce(a("keyword"),r),r}},{key:"buildShareBehaviours",value:function(e,t){t=t||"";var a=e?e.getProductHostName():"";t=t.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()});var r="".concat(a," : Share Content"),n="".concat(a," : Share Content on ").concat(t),i=this.listSubPaths(e);i.push("");var o=[];return i.forEach(function(e){e=e&&" : ".concat(e),o.push(new u(u.TYPES.ACTION,"".concat(r).concat(e)),new u(u.TYPES.ACTION,"".concat(n).concat(e)))}),o}},{key:"buildSurveySubmissionBehaviours",value:function(a,e){if(!e||!(e instanceof Array)||e.length<=0)return this.logger.error("Answers does not exist or empty"),[];var r=[];return e.forEach(function(e){var t="Survey Data : ".concat(a," : ").concat(e.tag," : ");e.choices instanceof Array!=!1&&e.choices.forEach(function(e){r.push(new u(u.TYPES.ACTION,"".concat(t).concat(e)))})}),r}},{key:"buildSurveyLoadedBehaviour",value:function(e){return e?[new u(u.TYPES.ACTION,"Survey Loaded : ".concat(e))]:[]}},{key:"buildAudienceSegmentRatingBehaviours",value:function(e,t,a){if("number"!=typeof a)return this.logger.error("Segment rating was not provided"),[];var r=0<a?"like":"dislike",n="Audience Segment Feedback : ".concat(e," : ").concat(r),i=[new u(u.TYPES.INTEREST,n)];if(t){var o="Family Feedback : ".concat(t," : ").concat(r);i.push(new u(u.TYPES.INTEREST,o))}return i}},{key:"buildTimestampBehaviours",value:function(e){var t=new Date,a="Timestamp",r={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"}[t.getDay()],n=t.getHours(),i=n<10?"0".concat(n,":00"):"".concat(n,":00");return[new u(u.TYPES.ACTION,"".concat(a," : ").concat(i," : ").concat(e)),new u(u.TYPES.ACTION,"".concat(a," : ").concat(r," : ").concat(e)),new u(u.TYPES.ACTION,"".concat(a," : ").concat(i," : ").concat(r," : ").concat(e))]}},{key:"buildCampaignReferralBehaviours",value:function(e){if(e.params&&void 0!==e.params.cmp&&null!==e.params.cmp){var t=decodeURI(e.params.cmp).replace(/\s+/g," ").match(/[^_]+/g),a="Referral : Campaign : ".concat(e.params.cmp);if(t&&"newsletter"===t[0].trim()){var r=t[0].trim(),n=t[1]?t[1].trim():"";a="Referral : Campaign : ".concat(r," : ").concat(n)}return[new u(u.TYPES.INTEREST,"".concat(a))]}return[]}},{key:"buildRegionChangeBehaviours",value:function(e){return e?[new u(u.TYPES.GENERIC_GEO,"Local Region : news : ".concat(e))]:[]}},{key:"buildAdTargetingOptOutBehaviour",value:function(e){return e?[new u(u.TYPES.ACTION,"Global Ad Targeting Opt Out : ".concat(e))]:[]}},{key:"buildStartWebSessionBehaviour",value:function(){return[new u(u.TYPES.ACTION,"Start Web Session")]}},{key:"buildReadBehaviours",value:function(e,t){var a=[],r=e?e.getProductHostName():"";if("comments"===t)a.push(new u(u.TYPES.ACTION,"".concat(r," : Read comment")));else for(var n="".concat(r," : Read"),i=this.listSubPaths(e),o=0;o<i.length;o++){var s=u.TYPES.INTEREST;o===i.length-1&&t&&"index"!==t&&(s=u.TYPES.MEDIA),a.push(new u(s,"".concat(n," : ").concat(i[o])))}return a}},{key:"buildCtaClickedBehaviours",value:function(e,t){var a=e?e.getProductHostName():"";return t?[new u(u.TYPES.ACTION,"".concat(a," : CTA clicked : ").concat(t))]:[]}}]),a}(),r=function(){function a(e){var t=e.logger;_classCallCheck(this,a),this.logger=t}return _createClass(a,[{key:"isValidString",value:function(e){return"string"==typeof e&&0<e.trim().length&&"nan"!==e.toLowerCase()&&"null"!==e.toLowerCase()&&"undefined"!==e.toLowerCase()}},{key:"getSectionsList",value:function(e){return e.replace(/^http[s]?:\/\//,"").split("/").slice(1)}},{key:"buildStreamedBehaviours",value:function(e,t){var a=[],r=e?e.getProductHostName():"",n="".concat(r," : streamed");if(t){if(a.push(new u(u.TYPES.ACTION,n)),t.content&&t.content.media)if(t.content.media.liveondemand&&"live"===t.content.media.liveondemand||"linear"===t.content.media.liveondemand)t.content.media.streamtitle&&a.push(new u(u.TYPES.INTEREST,"".concat(n," : ").concat(t.content.media.liveondemand," : ").concat(t.content.media.streamtitle)));else if(this.isValidString(t.content.media.show)){var i="".concat(n," : ").concat(t.content.media.show);if(a.push(new u(u.TYPES.INTEREST,i)),this.isValidString(t.content.media.seasonnumber)){var o="".concat(i," : season ").concat(t.content.media.seasonnumber);this.isValidString(t.content.media.episodenumber)?o="".concat(o," : episode ").concat(t.content.media.episodenumber):this.isValidString(t.content.media.streamtitle)&&(o="".concat(o," : ").concat(t.content.media.streamtitle)),a.push(new u(u.TYPES.MEDIA,o))}else this.isValidString(t.content.media.episodenumber)?a.push(new u(u.TYPES.MEDIA,"".concat(i," : episode ").concat(t.content.media.episodenumber))):this.isValidString(t.content.media.streamtitle)&&a.push(new u(u.TYPES.MEDIA,"".concat(i," : ").concat(t.content.media.streamtitle)))}t.feature&&this.isValidString(t.feature.name)&&a.push(new u(u.TYPES.ACTION,"".concat(n," : ").concat(t.feature.name)))}return a}},{key:"buildStreamedShortFormVideo",value:function(e){if(!e.content||!e.content.media)return[];var t=[e.content.media.genre,e.content.media.region,e.content.media.show,e.content.title];if(e.content.url&&!e.content.url.match(/\/player\/play\//)){var a=this.getSectionsList(e.content.url);a&&(t.push("embedded_in"),t=t.concat(a))}var r=["cbc.ca","streamed"].concat(_toConsumableArray(t.filter(function(e){return e}))).join(" : ");return[new u(u.TYPES.MEDIA,r)]}},{key:"buildSubscribedBehaviours",value:function(e){var t=[],a=e?e.getProductHostName():"",r="".concat(a," : subscribed");return t.push(new u(u.TYPES.ACTION,r)),t}},{key:"buildUnsubscribedBehaviours",value:function(e){var t=[],a=e?e.getProductHostName():"",r="".concat(a," : unsubscribed");return t.push(new u(u.TYPES.ACTION,r)),t}},{key:"buildLoadedBehaviours",value:function(e,t){var a=[],r=e?e.getProductHostName():"",n="".concat(r," : loaded");return t&&a.push(new u(u.TYPES.ACTION,"".concat(n," : user tier : ").concat(t))),a}}]),a}(),n=function(){function t(e){_classCallCheck(this,t),this.dmp=e,this.logger=e.logger,this.pubSub=e.pubSub,this.lotame=e.lotame,this.behaviourBuilder=e.behaviourBuilder,this.behaviourBuilderOtt=e.behaviourBuilderOtt}return _createClass(t,[{key:"init",value:function(){this._pageChangeSub=this._onPageChange.bind(this),this.pubSub.subscribe("pageChange",this._pageChangeSub),this._sendSurveyDataSub=this._onSendSurveyData.bind(this),this.pubSub.subscribe("surveySubmission",this._sendSurveyDataSub),this._sendSurveyNameSub=this._onSendSurveyName.bind(this),this.pubSub.subscribe("surveyLoad",this._sendSurveyNameSub),this._storySharedSub=this._onStoryShared.bind(this),this.pubSub.subscribe("SHARED",this._storySharedSub),this._rateSegmentSub=this._onRateSegment.bind(this),this.pubSub.subscribe("rateAudienceSegment",this._rateSegmentSub),this._regionChangeSub=this._onRegionChange.bind(this),this.pubSub.subscribe("regionChange",this._regionChangeSub),this._adTargetingOptOutSub=this._onAdTargetingOptOut.bind(this),this.pubSub.subscribe("adTargetingOptOut",this._adTargetingOptOutSub),this._startWebSessionSub=this._onStartWebSession.bind(this),this.pubSub.subscribe("START WEB SESSION",this._startWebSessionSub),this._videoStreamedSub=this._onVideoStreamed.bind(this),this.pubSub.subscribe("STREAMED",this._videoStreamedSub),this._subscribedEventSub=this._onSubscribedEvent.bind(this),this.pubSub.subscribe("SUBSCRIBED",this._subscribedEventSub),this._unsubscribedEventSub=this._onUnsubscribedEvent.bind(this),this.pubSub.subscribe("UNSUBSCRIBED",this._unsubscribedEventSub),this._loadedEventSub=this._onLoadedEvent.bind(this),this.pubSub.subscribe("LOADED",this._loadedEventSub),this._readEventSub=this._onReadEvent.bind(this),this.pubSub.subscribe("READ",this._readEventSub),this._ctaClickedEventSub=this._onCtaClicked.bind(this),this.pubSub.subscribe("ctaClicked",this._ctaClickedEventSub)}},{key:"_onPageChange",value:function(e,t){this.logger.debug("pageChange subscriber");var a=s.url;if(a){var r=this.behaviourBuilder.buildPageChangeBehaviours(new p(a),s.contentType,s.keywords,s.grapeshotCategories,s.grapeshotKeywords);this.lotame.sendBehaviours(r,!0)}}},{key:"_onStoryShared",value:function(e,t){this.logger.debug("Story shared - {0}",t);var a=new p(s.url),r=this.behaviourBuilder.buildShareBehaviours(a,t.network);this.lotame.sendBehaviours(r)}},{key:"_onSendSurveyData",value:function(e,t){this.logger.debug("Send survey data sub - {0}",t);var a=this.behaviourBuilder.buildSurveySubmissionBehaviours(t.name,t.answers);this.lotame.sendBehaviours(a)}},{key:"_onSendSurveyName",value:function(e,t){this.logger.debug("Send survey name sub - {0}",t);var a=this.behaviourBuilder.buildSurveyLoadedBehaviour(t);this.lotame.sendBehaviours(a)}},{key:"_onRateSegment",value:function(e,t){var a=t.segmentId,r=t.family,n=t.rating,i=this.behaviourBuilder.buildAudienceSegmentRatingBehaviours(a,r,n);this.lotame.sendBehaviours(i)}},{key:"_onRegionChange",value:function(e,t){var a=this.behaviourBuilder.buildRegionChangeBehaviours(t.title);this.lotame.sendBehaviours(a)}},{key:"_onAdTargetingOptOut",value:function(e,t){var a=this.behaviourBuilder.buildAdTargetingOptOutBehaviour(t);this.lotame.sendBehaviours(a)}},{key:"_onStartWebSession",value:function(e,t){var a=this.behaviourBuilder.buildStartWebSessionBehaviour();this.lotame.sendBehaviours(a)}},{key:"_onReadEvent",value:function(e,t){var a=CBC.APP.SC.DTM.formatted.googlecloud.content&&CBC.APP.SC.DTM.formatted.googlecloud.content.type;a=a||s.contentType;var r=new p(s.url),n=this.behaviourBuilder.buildReadBehaviours(r,a);this.lotame.sendBehaviours(n)}},{key:"_onVideoStreamed",value:function(e,t){var a=new p(s.url),r=a.hostname,n=this.behaviourBuilderOtt.buildStreamedBehaviours(a,t);"gem.cbc.ca"!=r&&"watch.cbc.ca"!=r&&(n=n.concat(this.behaviourBuilderOtt.buildStreamedShortFormVideo(t))),this.lotame.sendBehaviours(n)}},{key:"_onSubscribedEvent",value:function(e,t){var a=new p(s.url),r=this.behaviourBuilderOtt.buildSubscribedBehaviours(a);this.lotame.sendBehaviours(r)}},{key:"_onUnsubscribedEvent",value:function(e,t){var a=new p(s.url),r=this.behaviourBuilderOtt.buildUnsubscribedBehaviours(a);this.lotame.sendBehaviours(r)}},{key:"_onLoadedEvent",value:function(e,t){var a=new p(s.url),r=this.behaviourBuilderOtt.buildLoadedBehaviours(a,s.userTier);this.lotame.sendBehaviours(r)}},{key:"_onCtaClicked",value:function(e,t){this.logger.debug("Send App CTA click sub - {0}",t);var a=new p(s.url),r=this.behaviourBuilder.buildCtaClickedBehaviours(a,t);this.lotame.sendBehaviours(r)}}]),t}(),c=function(){function a(e){var t=e.logger;_classCallCheck(this,a),this.logger=t}return _createClass(a,[{key:"isLoggedIn",value:function(){try{var e=this.viafouraApi.users.current().user_privilege;return e&&"guest"!==e}catch(e){return!1}}},{key:"version",get:function(){return window.vf?2:window.viafoura?1:0}},{key:"viafouraApi",get:function(){return window.viafoura}},{key:"userId",get:function(){return this.isLoggedIn()?this.viafouraApi.users.current().id:(this.logger.debug("user unauthenticated!"),null)}},{key:"userPrivilege",get:function(){return this.isLoggedIn()&&this.viafouraApi.users.current().user_privilege?this.viafouraApi.users.current().user_privilege:(this.logger.debug("user has no privilege!"),null)}},{key:"userDateCreated",get:function(){var e=this.isLoggedIn()?this.viafouraApi.users.current().date_created:0;return 1<this.version&&(e/=1e3),e}},{key:"commentsMade",get:function(){return this.isLoggedIn()?this.viafouraApi.users.current().comments_made:0}},{key:"activityRange",get:function(){var e=(Date.now()/1e3-this.userDateCreated+1)/86400,t=this.commentsMade/e;return t<=0?"inactive":t<=1?"less than 1 comment per day":t<=5?"1-5 comments per day":t<=16?"5-16 comments per day":"more than 16 comments per day"}}]),a}(),l=function(){function i(e){var t=e.pubSub,a=e.logger,r=e.lotame,n=e.util;_classCallCheck(this,i),this.logger=a,this.lotame=r,this.pubSub=t,this.util=n}return _createClass(i,[{key:"init",value:function(){this._pageChangeSub=this.update.bind(this),this.pubSub.subscribe("pageChange",this._pageChangeSub)}},{key:"update",value:function(){-1==="//www.cbc.ca/cookie-jar/api/geoinfo/list".indexOf("www.cbc.ca")&&(900<=this.getSecondsDiff()?(this.updateSessionTime(),this.callGeoJson()):this.logger.debug("Skipping EdgescapeSession update"))}},{key:"callGeoJson",value:function(){var a=this,r="//www.cbc.ca/cookie-jar/api/geoinfo/list";this.util.makeGETRequest(r,{success:function(e,t){a.logger.debug("xhr.responseText: {0}",e.responseText),a.sendData(e.responseText)},failure:function(e,t){a.logger.error("Unable to talk to config URL: {0}",r)}})}},{key:"sendData",value:function(e){this.logger.trace("geo responseText: {0}",e);var t=JSON.parse(e),a=this.getGeoDataArr(t);this.lotame.sendBehaviours(a)}},{key:"getHumanReadableName",value:function(e){return e.match(/([A-Z])?[a-z]+/g).join(" ").toLowerCase()}},{key:"getGeoDataArr",value:function(e){var t=[];for(var a in e)if(e.hasOwnProperty(a)){var r=this.getHumanReadableName(a)+" : "+e[a];t.push(new u(u.TYPES.GENERIC_GEO,r))}return this.logger.trace("geo dataArr: {0}",t),t}},{key:"updateSessionTime",value:function(){var e={value:!0,timestamp:(new Date).getTime()};try{window.sessionStorage.setItem("edgescape",JSON.stringify(e))}catch(e){void 0===window.sessionStorage?this.logger.debug("This browser doesn't support sessionStorage. The error message is {0}",e):this.logger.debug("Unable to store edgescape in sessionStorage: {0}",e)}}},{key:"getSessionTime",value:function(){try{return JSON.parse(window.sessionStorage.getItem("edgescape")).timestamp}catch(e){return void 0===window.sessionStorage?this.logger.debug("This browser doesn't support sessionStorage. The error message is {0}",e):this.logger.debug("No value for key 'edgescape' in sessionStorage or 'timestamp' in edgescape."),0}}},{key:"getSecondsDiff",value:function(){var e=(new Date).getTime(),t=Math.floor((e-this.getSessionTime())/1e3);return this.logger.trace("Time difference: {0}",t),t}}]),i}(),d=function(){function n(e){var t=e.viafoura,a=e.pubSub,r=e.logger;_classCallCheck(this,n),this.vf=t,this.pubSub=a,this.logger=r,this.vfIdToLotame="vfidtolotame",this.lotamePixel=null,this.lotameScr="//bcp.crwdcntrl.net/map/c=10743/tp=VIAF/tpid="}return _createClass(n,[{key:"init",value:function(){var a=this;void 0===this.vf.viafouraApi?this.pubSub.subscribe("viafouraAvailable",function(e,t){a.addVfEvents()}):this.addVfEvents()}},{key:"run",value:function(){this.logger.debug("Running Viafoura/Lotame sync pixel code."),this.lotamePixel=this.getPixel(this.vfIdToLotame),this.vf.isLoggedIn()?this.lotamePixel?this.updatePixel():this.addPixel():this.lotamePixel&&this.deletePixel()}},{key:"addVfEvents",value:function(){var e=this;this.logger.debug("Add Viafoura events");try{this.vf.viafouraApi.subscribe("onLoginSuccess",function(){e.run()})}catch(e){this.logger.error("Can't subscribe onLoginSuccess event.")}try{this.vf.viafouraApi.subscribe("onLogoutSuccess",function(){e.run()})}catch(e){this.logger.error("Can't subscribe onLogoutSuccess event.")}}},{key:"getPixel",value:function(e){return document.getElementById(e)}},{key:"addPixel",value:function(){this.logger.debug("Add Viafoura/Lotame sync pixel code.");var e=document.createElement("img");e.src=this.lotameScr+this.vf.userId,e.id=this.vfIdToLotame,e.async=!0,document.body.appendChild(e)}},{key:"updatePixel",value:function(){this.logger.debug("Update Viafoura/Lotame sync pixel code.");var e=this.getPixel(this.vfIdToLotame),t=this.lotameScr+this.vf.userId;e.src=t}},{key:"deletePixel",value:function(){this.logger.debug("Delete Viafoura/Lotame sync pixel code."),this.getPixel(this.vfIdToLotame).remove()}}]),n}(),C="Identities",h=function(){function o(e){var t=e.logger,a=e.viafoura,r=e.lotame,n=e.pubSub,i=e.util;_classCallCheck(this,o),this.logger=t,this.viafoura=a,this.lotame=r,this.pubSub=n,this.util=i}return _createClass(o,[{key:"init",value:function(){this._viafouraAvailableSub=this._onViafouraAvailable.bind(this),void 0===this.viafoura.viafouraApi?this.pubSub.subscribe("viafouraAvailable",this._viafouraAvailableSub):this._viafouraAvailableSub(),this._signInSub=this._onSignIn.bind(this),this.pubSub.subscribe("SIGNED IN",this._signInSub),this._signOutSub=this._onSignOut.bind(this),this.pubSub.subscribe("SIGNED OUT",this._signOutSub)}},{key:"callLoginRadiusApi",value:function(e){var a=this;this.util.makeGETRequest("//api.loginradius.com/identity/v2/auth/account?apikey=3f4beddd-2061-49b0-ae80-6f1f2ed65b37",{success:function(e,t){a.logger.debug("User logged in success : {0}",e.responseText),a.sendData(JSON.parse(e.responseText))},failure:function(e,t){a.logger.error("Error : login radius api call to get user profile")}},void 0,void 0,{Authorization:"Bearer "+e},void 0)}},{key:"getGender",value:function(e){var t="Gender",a="CustomFields",r="GenderDescription";if(e[C]){var n=!0,i=!1,o=void 0;try{for(var s,c=e[C][Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var u=s.value;if(u[t])return u[t]}}catch(e){i=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(i)throw o}}}return e[a]&&e[a][r]?e[a][r]:e[t]||""}},{key:"getAge",value:function(e){if(e[C]){var t=!0,a=!1,r=void 0;try{for(var n,i=e[C][Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=n.value;if(o.Age)return o.Age}}catch(e){a=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(a)throw r}}}return e.Age||""}},{key:"getPostalCode",value:function(e){var t="Addresses",a="PostalCode",r=e[t]&&e[t][0]&&e[t][0][a];if(e[C]){var n=!0,i=!1,o=void 0;try{for(var s,c=e[C][Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var u=s.value;if(u[t]&&u[t][0]&&u[t][0][a])return u[t][0][a].substring(0,3)}}catch(e){i=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(i)throw o}}}return r?e[t][0][a].substring(0,3):""}},{key:"sendData",value:function(e){var t;if(e){var a=this.getGender(e),r=this.getAge(e),n=this.getPostalCode(e);t=[new u(u.TYPES.GENERIC_DEMO,"User Info : Gender : "+a),new u(u.TYPES.GENERIC_DEMO,"User Info : Age : "+r),new u(u.TYPES.GENERIC_GEO,"User Info : Postal Code : "+n)],this.lotame.sendBehaviours(t)}}},{key:"_onSignIn",value:function(){var e=this.accessTokenForUser;this.loginRadiusV2&&e&&this.callLoginRadiusApi(e)}},{key:"_onSignOut",value:function(){this.lotame.sendBehaviours([new u(u.TYPES.ACTION,"User Info : Sign out")])}},{key:"_onViafouraAvailable",value:function(){var e;e=this.viafoura.userId?[new u(u.TYPES.CUSTOM_SEGMENT,"Authenticated User"),new u(u.TYPES.CUSTOM_SEGMENT,"User privilege: "+this.viafoura.userPrivilege),new u(u.TYPES.CUSTOM_SEGMENT,"User activity range: "+this.viafoura.activityRange)]:[new u(u.TYPES.CUSTOM_SEGMENT,"Unauthenticated User")],this.lotame.sendBehaviours(e)}},{key:"loginRadiusV2",get:function(){return this.viafoura&&this.viafoura.viafouraApi&&this.viafoura.viafouraApi.core&&this.viafoura.viafouraApi.core.loginRadiusSVOD&&this.viafoura.viafouraApi.core.loginRadiusSVOD.LRV2?this.viafoura.viafouraApi.core.loginRadiusSVOD.LRV2:window.LoginRadiusV2?window.LoginRadiusV2:void 0}},{key:"accessTokenForUser",get:function(){return window.localStorage.getItem("LRTokenKey")?window.localStorage.getItem("LRTokenKey").replace(/"/g,""):window.localStorage.getItem("lrtoken")?window.localStorage.getItem("lrtoken").replace(/"/g,""):null}}]),o}(),A=function(){function t(e){_classCallCheck(this,t),this.pubSub=e.pubSub,this.util=e.util,this.logger=e.logger,this.lotame=e.lotame,this.behaviourBuilder=new a(this),this.behaviourBuilderOtt=new r(this),this.subscribers=new n(this),this.viafoura=new c(this),this.syncPixel=new d(this),this.edgescapeSession=new l(this),this.userInfo=new h(this),this._modules=[this.subscribers,this.syncPixel,this.edgescapeSession,this.userInfo]}return _createClass(t,[{key:"init",value:function(){/\/(kids|kidsnews|kidscbc2|kidsfantasyhockey)(\/|$)/.test(s.url.toLowerCase())?this.logger.debug("Not initializing DMP on CBC Kids or Kids News"):this._modules.forEach(function(e){return e.init()})}}]),t}();[window.Element.prototype,window.CharacterData.prototype,window.DocumentType.prototype].forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})}),function(){window.CBC=window.CBC||{};var e=window.CBC;e.APP=e.APP||{},e.APP.DMP=e.APP.DMP||{};var t=new A({logger:e.APP.DMP.LOGGER,lotame:e.APP.DMP.LOTAME,pubSub:e.APP.PubSub,util:e.APP.SC.UTIL});t.logger.debug("DMP initialize starting"),t.init(),e.APP.DMP.pageChange=function(){t.logger.debug("Forced DMP pageChange"),s.spa&&e.APP.PubSub.publish("pageChange")}}()}(),CBC.APP.SC.Subscribers.pageview=CBC.APP.SC.Subscribers.pageview||[],CBC.APP.SC.Pillar=CBC.APP.SC.Pillar||{},CBC.APP.SC.PageTracker=function(){var c=CBC.APP.SC.UTIL,u=null,l=[],d=!1;l.pageviewcount=0;var C=!1;function t(){l.channel="misc",l.subsection=[],l.pageurl="",l.searchprefix="",l.separator=":",l.index="index",l.contenttype="page",l.pagetype="",l.pagetitle="",l.scqs={},l.directory="",l.pageName=null,l.hier1=null}return t(),{init:function(){try{CBC.APP.PubSub.turnOn()}catch(e){console.log("There has been an error: "+e)}var e=document.location.href;if(-1<e.indexOf("polopoly")||-1<e.indexOf("/meta/preview")||-1<e.indexOf("/preview/www")||-1<e.indexOf("/preview/web"))return c.console("Preview page. Page Tracking Disabled."),!1;if(-1!==window.Detectizr.ua.indexOf("googlebot"))return!1;if(c.inDebugMode(),!s_cbc_sitecatalyst)return c.console("The Adobe s_code.js is missing on the page"),!1;u=s_cbc_sitecatalyst,C?(this.clearVariables(),window.CBC.APP.SC.Subscribers.pageview.push({cb:function(){window.dispatchEvent(new window.CustomEvent("ConductricsStateChange",{detail:u.pageName}))}})):document.addEventListener("click",CBC.APP.ANA.LinkTracker.checkClickEvent);var t=CBC.APP.versions["cbc-stats-top"],a=CBC.APP.versions["cbc-stats-bottom"];if(void 0!==t&&void 0!==a&&this.checkStatsVersions(t,a),u.prop36=(window.self!==window.top).toString(),void 0===CBC.APP.SC.DTM&&(CBC.APP.SC.DTM={}),void 0===CBC.APP.SC.DTM.DATA&&(CBC.APP.SC.DTM.DATA={}),0<Object.keys(CBC.APP.SC.DTM.DATA).length?(CBC.APP.SC.DTM.DATA.authenticated=this.isLoggedIn(),c.setFormattedLayer(),l.scqs=JSON.parse(JSON.stringify(CBC.APP.SC.DTM.formatted.adobe)),l.scqs.storytitle&&(l.scqs.title=l.scqs.storytitle,CBC.APP.SC.storyTitle=l.scqs.storytitle.toLowerCase().replace(/\s/g,"-")),l.pagetitle||(l.pagetitle=l.scqs.pagetitle?l.scqs.pagetitle:""),l.scqs.publishedTime&&(l.scqs.pubdate=l.scqs.publishedTime),u.prop75="new"):(c.console("Data Layer - Data layer not found. Defaulting to URL."),l.scqs=this.urlToObj(document.location.hostname,document.location.pathname),u.prop75="dne"),c.initReferringDepartmentStatus(),this.setTimeVars(),this.setOsAppVars(),this.setSearchPrefix(),this.getAdHierarchy(),this.setFromMetaTags(),CBC.APP.readJS.checkLoad(),this.getUrl(),CBC.APP.SC.DTM.DATA.spa&&0<l.pageviewcount?this.getReferrer(l.scqs.referrer.url):(this.getReferrer(document.referrer),window.conductricsDataLayer=window.conductricsDataLayer||[],CBC.APP.SC.DTM&&window.conductricsDataLayer.push(CBC.APP.SC.DTM)),l.scqs.referrer&&l.scqs.referrer.pillar?u.prop53=l.scqs.referrer.pillar:u.prop53="noReferrer",l.scqs.referrer&&l.scqs.referrer.department){var r=l.scqs.referrer.department;u.prop65=[r.level1,r.level2,r.level3].filter(function(e){return e}).join(":"),u.prop65="noreferrer"===u.prop65?"noReferrer":u.prop65}else u.prop65="noReferrer";CBC.APP.SC.DTM.DATA.wordcount&&(u.prop7=CBC.APP.SC.DTM.DATA.wordcount),this.setWordCount(),this.setStrategicPillar(),this.setCMFAppId(),this.readLinkTrackerCookie(),this.setUserJourney(),this.setUserTier(),this.setDateVars(),this.setSponsor(),this.setContentPartner(),this.detectAdBlocker(),this.checkCbcIdCookieExists(),this.checkHTTPSstatus(document.location.href),this.checkFeatureAttributionInDTM(),this.checkEmbeddedMedia(),this.setCBCPlusID(),!d&&window.vf&&window.vf.$once&&(window.vf.$once("comments","read",function(e){window.vf.context.get("page").then(function(e){e.num_replies&&CBC.APP.SC.EventTracker.trackEvent("READ",{content:{type:"comments"}})}),d=!1}),d=!0),this.parseStatsVars(),CBC.APP.PubSub.publish("pageChange"),CBC.APP.COMSCORE&&CBC.APP.COMSCORE.Call(),CBC.APP.CXENSE&&CBC.APP.CXENSE.pageView(),window._sf_async_config.cbc&&"gamp"!==l.scqs.syndicate&&window._sf_async_config.cbc.pageChange(),CBC.APP.ANA.DISPATCHERS.FBPIXEL&&CBC.APP.ANA.DISPATCHERS.FBPIXEL.pageView();var n={},i="LOADED";(u.prop22||u.prop23||u.prop24||u.dataFeatureValue)&&(n.feature={},u.prop22&&(n.feature.name=u.prop22),u.prop23&&(n.feature.instance=u.prop23),u.prop24&&(n.feature.position=u.prop24),u.dataFeatureValue&&(n.feature.value=u.dataFeatureValue)),l.scqs.referrer&&l.scqs.referrer.url===l.scqs.url&&(i="LOADED MORE"),"LOADED"===i&&(n.custom={},n.custom.DNT=CBC.APP.SC.UTIL.getDoNotTrackValue(),n.custom.cookiesenabled=window.navigator.cookieEnabled),CBC.APP.SC.EventTracker.trackEvent(i,n),l.pageviewcount+=1,C||(C=!0,window.viafoura&&window.viafoura.users&&window.viafoura.users.current&&window.viafoura.users.current().id?c.setCBCPlusIDPromise().catch(function(e){CBC.APP.SC.UTIL.console(e)}):c.setCBCVisitorIDPromise().catch(function(e){CBC.APP.SC.UTIL.console(e)}));var o=0,s=window.setInterval(function(){if(u.pageName&&u.events||39<o){var e=CBC.APP.SC.Subscribers.pageview,t=e.length,a=0;for(a=0;a<t;++a)"function"==typeof e[t-a-1].cb?e.pop().cb():e.pop();window.clearInterval(s)}else++o},10);return!0},checkFeatureAttributionInDTM:function(){return!!(CBC.APP.SC.DTM&&CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&CBC.APP.SC.DTM.formatted.adobe.feature&&(CBC.APP.SC.DTM.formatted.adobe.feature.name||CBC.APP.SC.DTM.formatted.adobe.feature.position||CBC.APP.SC.DTM.formatted.adobe.feature.instance))&&(CBC.APP.SC.DTM.formatted.adobe.feature.name&&(u.prop22=CBC.APP.SC.DTM.formatted.adobe.feature.name,u.eVar83="D=c22"),CBC.APP.SC.DTM.formatted.adobe.feature.position&&(u.prop24=CBC.APP.SC.DTM.formatted.adobe.feature.position,u.eVar84="D=c24"),CBC.APP.SC.DTM.formatted.adobe.feature.instance&&(u.prop23=CBC.APP.SC.DTM.formatted.adobe.feature.instance,u.eVar85="D=c23"),!0)},checkEmbeddedMedia:function(){CBC.APP.SC.DTM&&CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&["story","segment","blogentry"].includes(CBC.APP.SC.DTM.DATA.contenttype)&&(u.prop16=CBC.APP.SC.DTM.formatted.adobe.embedtypes)},checkCbcIdCookieExists:function(){c.getCookie("CBC_ID")?(c.expireCookie("CBC_ID"),u.prop73="true"):u.prop73="false"},checkHTTPSstatus:function(e){return new RegExp(/^https:\/\//).test(e)?(u.prop74="yes",!0):!(u.prop74="no")},objToQueryString:function(e){var t,a="";for(t in e)e.hasOwnProperty(t)&&(a+="&"+t+"="+e[t]);return a.slice(1)},detectAdBlocker:function(){CBC.APP.SC.ads?(u.prop68="false",u.eVar68="false"):(u.prop68="true",u.eVar68="true")},urlToObj:function(e,t){var a,r=t.split("/"),n={},i=0;i=(e.match("cbcmusic")?n.contentarea="music":n.contentarea="misc",1);for(var o=0;o<r.length;o++)""!==r[o]&&(a="subsection"+i,i++,n[a]=c.sanitize(r[o]));return n.contenttype="index",n.url="https://"+e+t,n},getReferrer:function(e){return void 0!==e&&""!==e&&(u.prop57=e,u.eVar57="D=c57",!0)},setInitialized:function(){C=!0},setUserTier:function(){window.viafoura&&window.viafoura.users&&window.viafoura.users.current&&window.viafoura.users.current().user_privilege?this.isLoggedIn()?u.prop58="authenticated":u.prop58="unauthenticated":CBC&&CBC.APP&&CBC.APP.SC&&CBC.APP.SC.DTM&&CBC.APP.SC.DTM.DATA&&CBC.APP.SC.DTM.DATA.userTier&&(u.prop58=CBC.APP.SC.DTM.DATA.userTier)},readLinkTrackerCookie:function(){var t="SC_LINKS",a="DATA_FEATURE_LINKS";try{var e=window.s_cbc_sitecatalyst.c_r(a);if(e){var r=JSON.parse(e),n=CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.feature;u.prop21=r.pageName,u.prop22=n.name[r.dataFeatureName]?r.dataFeatureName:void 0,u.prop23=n.instance[r.dataFeatureInstance]?r.dataFeatureInstance:void 0,u.prop24=n.position[r.dataFeaturePosition]?r.dataFeaturePosition:void 0,u.dataFeatureValue=n.value[r.dataFeatureValue]?r.dataFeatureValue:void 0}else if(e=window.s_cbc_sitecatalyst.c_r(t),CBC.APP.SC.masterSwitch.switches.legacysclt&&e){var i=JSON.parse(e);u.prop21=i.pageName,u.prop22=i.linkName,u.prop24=i.linkPosition}}catch(e){window.s_cbc_sitecatalyst.c_w(a,"",0),window.s_cbc_sitecatalyst.c_w(t,"",0)}window.s_cbc_sitecatalyst.c_w(a,"",0),window.s_cbc_sitecatalyst.c_w(t,"",0)},parseStatsVars:function(){var e;for(l.scqs.contentarea?l.channel=l.scqs.contentarea:l.scqs.contentArea&&(l.channel=l.scqs.contentArea),u.channel=l.channel,l.subsection=[],l.scqs.contenttype&&(l.contenttype=l.scqs.contenttype),u.prop4=l.contenttype,e=1;e<=5;e++)l.scqs["subsection"+e]&&l.subsection.push(l.scqs["subsection"+e]);l.scqs.contentid&&(u.prop6=l.scqs.contentid),this.setContentVars(),u.pageName=this.setPageName(),u.hier1=l.hier1,this.setSubsectionVars(),u.prop14=this.removeDomain(l.pageurl),u.eVar14=l.pageurl,u.prop15=this.getUserSegmentation(),this.registerPageView()},setCMFAppId:function(){l.scqs.cmfAppId&&(u.prop69=l.scqs.cmfAppId)},setStrategicPillar:function(){0===Object.getOwnPropertyNames(CBC.APP.SC.Pillar).length&&(CBC.APP.SC.Pillar={pillar:{available:["feed","listen","watch","legacyee"],url:{default:"legacy","cbc.ca/listen":"listen","cbcmusic.ca":"listen","watch.cbc.ca":"watch","gem.cbc.ca":"watch","watch.qa.nm.cbc.ca":"watch","gem.qa.nm.cbc.ca":"watch"}}});var e=CBC.APP.SC.Pillar.pillar;if(u.prop67=e.url.default,l.scqs.pillar&&-1<e.available.indexOf(l.scqs.pillar))u.prop67=c.sanitize(l.scqs.pillar);else if(!CBC.APP.SC.QueryString&&!window.scstats&&CBC.APP.SC.DTM.DATA.pillar&&-1<e.available.indexOf(CBC.APP.SC.DTM.DATA.pillar))u.prop67=c.sanitize(CBC.APP.SC.DTM.DATA.pillar);else for(var t in e.url)if(e.url.hasOwnProperty(t)&&-1<l.pageurl.indexOf(t)){u.prop67=e.url[t],CBC.APP.SC.DTM.DATA.pillar=e.url[t],l.scqs.pillar=e.url[t];break}},setUserJourney:function(){var e=CBC.APP.SC.Pillar.pillar.url.default;void 0!==l.scqs.pillar&&l.scqs.pillar!==e?e=l.scqs.pillar:u.prop67!==e&&(e=u.prop67),void 0!==l.scqs.syndicate&&"cbcca-web"!==l.scqs.syndicate?e=l.scqs.syndicate:"cbcca-web"!==u.prop66&&(e=u.prop66),u.prop35=e+":"+l.scqs.contentarea+":"+l.scqs.contenttype},setTimeVars:function(){var e=this.getTimeVars();void 0!==e.var9&&(u.prop9=e.var9),void 0!==e.var10&&(u.prop10=e.var10)},getTimeVars:function(){function e(e){return"number"==typeof e?("0"+e).slice(-2):null}var t,a,r={},n=new Date,i=(t=n)&&"function"==typeof t.getTimezoneOffset?-t.getTimezoneOffset()/60:null,o=n.getDay(),s=0===o||6===o?"weekend":"weekday";return r.var9=((a=n)&&"function"==typeof a.getHours?e(a.getHours())+e(a.getMinutes()):null)+"|"+i,r.var10=s+"|"+["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][o]+"|"+("0"+n.getHours()).slice(-2)+(30<n.getMinutes()?"30":"00"),r},setOsAppVars:function(){var e=this.getOsAppVars();void 0!==e.var60&&(u.prop60=e.var60),void 0!==e.var61&&(u.prop61=e.var61),void 0!==e.var62&&(u.prop62=e.var62),void 0!==e.var63&&(u.prop63=e.var63),void 0!==e.var64&&(u.prop64=e.var64)},getAdHierarchy:function(){l.scqs.hierarchy?u.prop65=l.scqs.hierarchy:CBC.Metadata&&CBC.Metadata.hierarchy&&(u.prop65=CBC.Metadata.hierarchy)},getOsAppVars:function(){var e={};return CBC.APP.SC.DTM.formatted&&CBC.APP.SC.DTM.formatted.adobe&&CBC.APP.SC.DTM.formatted.adobe.appname?e.var60=CBC.APP.SC.DTM.formatted.adobe.appname:e.var60="cbcca-web",e.var61="osVersion",e.var62="os",e.var63="web",e.var64="2.76.0",e.var64=l.scqs.appVersion?l.scqs.appVersion:e.var64,void 0===window.Detectizr||void 0===window.Detectizr.os||("undefined"!==window.Detectizr.os.name&&("ott-web-app"===e.var60?e.var62=window.Detectizr.os.name+"|"+e.var60:e.var62=window.Detectizr.os.name),"undefined"!==window.Detectizr.os.version&&(e.var61=window.Detectizr.os.version)),e},setFromMetaTags:function(){var e,t=document.getElementsByTagName("META");if(l.scqs.originaltitle)l.originalHeadline=l.scqs.orginaltitle;else{for(e=0;e<t.length;e++)"original-headline"===t[e].name&&(l.originalHeadline=t[e].content);CBC.APP.SC["original-headline"]&&(l.originalHeadline=CBC.APP.SC["original-headline"],l.originalHeadline=l.originalHeadline.replace(/\s/g,"-"),l.originalHeadline=l.originalHeadline.toLowerCase())}if("string"==typeof l.scqs.keywords)u.list1=l.scqs.keywords.replace(/, /g,",").replace(/\s/g,"-").toLowerCase();else if("object"===_typeof(l.scqs.keywords))u.list1=this.parseKeywords(l.scqs.keywords);else for(e=0;e<t.length;e++)"keywords"===t[e].name&&(u.list1=t[e].content.replace(/, /g,",").replace(/\s/g,"-").toLowerCase());l.scqs.experiments&&l.scqs.experiments.content&&(u.list3=l.scqs.experiments.content.trim()),u.list2=l.scqs.authors?l.scqs.authors.replace(/, /g,",").replace(/\s/g,"-").toLowerCase():void 0,l.scqs.syndicate?u.prop66=c.normalize(l.scqs.syndicate):CBC.APP.SC.syndicate?u.prop66=c.normalize(CBC.APP.SC.syndicate):u.prop66="cbcca-web"},setCBCPlusID:function(){var e=c.getCookie("cbc_plus");e&&(u.eVar8=e)},setWordCount:function(){CBC.APP.SC.DTM.formatted.adobe.wordcount&&["story","segment","blogentry"].includes(CBC.APP.SC.DTM.DATA.contenttype)&&(u.prop7=CBC.APP.SC.DTM.formatted.adobe.wordcount)},setContentVars:function(){if(l.scqs.author&&(u.prop25=l.scqs.author),l.scqs.title&&l.scqs.pubdate&&l.scqs.contentid){var e,t=new Date(parseInt(l.scqs.pubdate)),a=t.getUTCDate();a<10&&(a="0"+a);var r=t.getUTCMonth()+1;r<10&&(r="0"+r),e=t.getUTCFullYear()+"/"+r+"/"+a+"/"+l.scqs.contentid,u.prop27=e+":"+l.scqs.title}l.scqs.section&&(u.prop26=l.scqs.section,l.subsection.push(l.scqs.section)),l.scqs.sitename&&(u.prop26=l.scqs.sitename),l.scqs.postdate&&(u.prop28=l.scqs.postdate)},getUrl:function(){var e="";if(e=CBC.APP.SC.url?CBC.APP.SC.url:l.scqs.url?decodeURIComponent(l.scqs.url):window.location.href,!c.isExternallyHosted()){var t=e.indexOf("#");-1!==t&&(e=e.substring(0,t));var a=e.indexOf("?");-1!==a&&(e=e.substring(0,a))}l.pageurl=e},removeDomain:function(e){return e.replace(/https?:\/\/.*?cbc(music)?\.ca(:.*?)*\//,"")},setSubsectionVars:function(){for(var e=0;e<3;e++)if(l.subsection[e]){var t=l.subsection.slice(0,e+1);u["prop"+(e+1)]=l.channel+":"+t.join(":")}},clearVariables:function(){try{c.console("before clearing variables",s_cbc_sitecatalyst);var e=l.pageviewcount;(l=[]).pageviewcount=e,t(),delete window.s_cbc_sitecatalyst.pageName,window.s_cbc_sitecatalyst.clearVars(),c.console("after clearing variables",s_cbc_sitecatalyst)}catch(e){console.log(e)}},copyPropsToEvars:function(){u.prop1&&!u.eVar1&&(u.eVar1="D=c1"),u.prop2&&!u.eVar2&&(u.eVar2="D=c2"),u.prop3&&!u.eVar3&&(u.eVar3="D=c3"),u.prop4&&!u.eVar4&&(u.eVar4="D=c4"),u.prop5&&!u.eVar5&&(u.eVar5="D=c5"),u.prop6&&!u.eVar6&&(u.eVar6="D=c6"),u.prop7&&!u.eVar7&&(u.eVar7="D=c7"),u.prop9&&!u.eVar9&&(u.eVar9="D=c9"),u.prop10&&!u.eVar10&&(u.eVar10="D=c10"),u.pageName&&!u.eVar11&&(u.eVar11="D=pageName"),u.channel&&!u.eVar12&&(u.eVar12="D=ch"),u.prop13&&!u.eVar13&&(u.eVar13="D=c13"),u.prop15&&!u.eVar15&&(u.eVar15="D=c15"),u.prop16&&!u.eVar16&&(u.eVar16="D=c16"),u.prop17&&!u.eVar17&&(u.eVar17="D=c17"),u.prop18&&!u.eVar18&&(u.eVar18="D=c18"),u.prop25&&!u.eVar25&&(u.eVar25="D=c25"),u.prop26&&!u.eVar26&&(u.eVar26="D=c26"),u.prop27&&!u.eVar27&&(u.eVar27="D=c27"),u.prop28&&!u.eVar28&&(u.eVar28="D=c28"),u.prop35&&!u.eVar35&&(u.eVar35="D=c35"),u.prop36&&!u.eVar36&&(u.eVar36="D=c36"),u.prop37&&!u.eVar37&&(u.eVar37="D=c37"),u.prop40&&!u.eVar40&&(u.eVar40="D=c40"),u.prop41&&!u.eVar41&&(u.eVar41="D=c41"),u.prop42&&!u.eVar42&&(u.eVar42="D=c42"),u.prop44&&!u.eVar44&&(u.eVar44="D=c44"),u.prop45&&!u.eVar45&&(u.eVar45="D=c45"),u.prop46&&!u.eVar46&&(u.eVar46="D=c46"),u.prop47&&!u.eVar47&&(u.eVar47="D=c47"),u.prop48&&!u.eVar48&&(u.eVar48="D=c48"),u.prop51&&!u.eVar51&&(u.eVar51="D=c51"),u.prop52&&!u.eVar52&&(u.eVar52="D=c52"),u.prop53&&!u.eVar53&&(u.eVar53="D=c53"),u.prop58&&!u.eVar58&&(u.eVar58="D=c58"),u.prop60&&!u.eVar60&&(u.eVar60="D=c60"),u.prop61&&!u.eVar61&&(u.eVar61="D=c61"),u.prop62&&!u.eVar62&&(u.eVar62="D=c62"),u.prop63&&!u.eVar63&&(u.eVar63="D=c63"),u.prop64&&!u.eVar64&&(u.eVar64="D=c64"),u.prop65&&!u.eVar65&&(u.eVar65="D=c65"),u.prop66&&!u.eVar66&&(u.eVar66="D=c66"),u.prop67&&!u.eVar67&&(u.eVar67="D=c67"),u.prop69&&!u.eVar69&&(u.eVar69="D=c69"),u.prop70&&!u.eVar70&&(u.eVar70="D=c70"),u.prop73&&!u.eVar73&&(u.eVar73="D=c73")},buildPageName:function(){var e=l.subsection.join(l.separator),t=[];0<arguments.length&&(t=c.arrayFromArguments(arguments)),t[0]&&c.typecheck(t[0]).array&&0<t[0].length&&(t=t[0]),0<l.subsection.length&&t.splice(0,0,e),t.splice(0,0,l.channel);for(var a=t.length;0<=a;a--){if(t[a]&&void 0!==l.scqs.contentid&&t[a]===u.prop5&&l.scqs.pubdate&&l.scqs.contenttype){var r=new Date(parseInt(l.scqs.pubdate)),n=r.getUTCDate();n<10&&(n="0"+n);var i=r.getUTCMonth()+1;i<10&&(i="0"+i),t[a]=r.getUTCFullYear()+"-"+i+"-"+n+"-"+l.scqs.contentid+"-"+t[a];break}if(t[a]&&void 0!==l.scqs.contentid&&t[a]===u.prop5&&l.scqs.contenttype){t[a]=l.scqs.contentid+"-"+t[a];break}}return(CBC.APP.SC.PageTracker.objEmpty(l.scqs)&&!l.directory?"misc:"+l.pageurl.replace(/:/g,"-"):t.join(l.separator)).toLowerCase().replace(/\s/g,"-")},conditionalEqualInArray:function(e,t){for(var a=e.length,r=0;r<a;r++)if(e[r]===t)return!0;return!1},getPageName:function(){return l.pageName},setPageName:function(){if("page"!==l.contenttype){this.conditionalEqualInArray(["story","episode","segment","feature","blogentry","media","authorbio","riding","image","link","photogallery","stub","bio","recipe"],l.contenttype)&&l.scqs.title?this.handleStory():"videoclip"!==l.contenttype&&"audioclip"!==l.contenttype||!l.scqs.title?"error"===l.contenttype?this.handleErrorPage():"index"===l.contenttype?this.handleIndexPage():this.handleOtherContent():this.handleVideoClip()}else"page"===l.contenttype&&this.handleGenericPage();return l.pageName},setTitle:function(){l.scqs.title&&!u.prop5&&(l.scqs.title=l.scqs.title.replace(/\//g,"-"),u.prop5=l.scqs.title)},setSponsor:function(){l.scqs.sponsor&&l.scqs.sponsor.name&&(CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.sponsor.name[l.scqs.sponsor.name]?u.prop51=l.scqs.sponsor.name:delete l.scqs.sponsor)},setContentPartner:function(){l.scqs.partner&&l.scqs.partner.name&&CBC.APP.SC.UTIL.getMetadataWhitelist().metadata.whitelist.partner.name[l.scqs.partner.name]&&(u.prop52=l.scqs.partner.name)},handleStory:function(){if(CBC.APP.SC.storyTitle&&(u.prop5=CBC.APP.SC.storyTitle,l.originalHeadline)){var e=l.scqs.title.split("-",1);l.scqs.title=e+"-"+l.originalHeadline}l.scqs.originaltitle&&(l.scqs.title=l.scqs.originaltitle),l.scqs.title=l.scqs.title.replace(/\//g,"-").replace(/\s/g,"-").toLowerCase(),u.prop5||(u.prop5=l.scqs.title),l.pageName=this.buildPageName(l.contenttype,l.scqs.title),u.prop11="D=pageName",l.hier1=this.getHierarchy()},handleVideoClip:function(){this.setTitle(),l.pageName=this.buildPageName(l.contenttype,l.scqs.title),l.hier1=this.getHierarchy()},handleErrorPage:function(){u.pageType="errorPage",l.pageName=this.buildPageName(),l.hier1=this.getHierarchy()},handleIndexPage:function(){l.pageName=this.buildPageName("index"),l.hier1=this.getHierarchy()},handleOtherContent:function(){l.contenttype?(l.pageName=this.buildPageName(l.contenttype),"audioclip"===l.contenttype&&this.setTitle()):l.pageName=this.buildPageName(),l.hier1=this.getHierarchy()},handleGenericPage:function(){var e=[];if(this.objEmpty(l.scqs)&&l.directory){e.push(l.directory);var t=this.getSubFolders(l.directory);""!==t&&e.push(t)}var a=this.getCurrentFile();"cbc"===a||"web"===a||l.scqs.filename||e.push(a),0<e.length?l.pageName=this.buildPageName(e):l.pageName=this.buildPageName(),l.hier1=this.getHierarchy(l.directory)},getHierarchy:function(e){if(0===l.subsection.length)return l.channel;var t=l.subsection.join(","),a=l.channel+","+t;return e&&(a+=","+e),a},registerPageView:function(){this.copyPropsToEvars(),u.campaign||(u.campaign=u.Util.getQueryParam("cmp")),u.campaign=u.getValOnce(u.campaign,"s_campaign",0),u.hbx_lt="auto",u.events=u.apl(u.events,"event2",",",2),u.prop71="undefined"!=typeof Visitor?"VisitorAPI Present":"VisitorAPI Missing",u.t()},getSubFolders:function(e){var t=l.pageurl,a=new RegExp(e+"\\/(.*)\\/"),r=t.match(a);return r&&2===r.length?r[1].replace("/",l.separator):""},getCurrentFile:function(){var e=l.pageurl.match(/.*\/([^?#]*)/)[1];return""!==e?e:"index.html"},getVal:function(e){return l[e]},objEmpty:function(e){for(var t in e)if("function"!=typeof e[t])return!1;return!0},setSearchPrefix:function(){0<window.location.port.length?l.searchprefix="cbc.ca:"+window.location.port+"/":l.searchprefix="cbc.ca/"},getUserSegmentation:function(){var e=this.isLoggedIn()?"loggedin":"anonymous",t=this.isCommentor()?"commentor":"";return e+(t?" | "+t:"")},isLoggedIn:function(){try{return"guest"!==window.viafoura.users.current().user_privilege}catch(e){return!1}},isCommentor:function(){try{return 0<window.viafoura.users.current().comments_made}catch(e){return!1}},setDateVars:function(){var e=this.getDateVars();void 0!==e.var13&&(u.prop13=e.var13)},getDateVars:function(){var e={};if(!/^(index|bio)$/i.test(l.scqs.contenttype)){var t,a=new RegExp("^\\d+$");a.test(CBC.APP.SC.publishedTime)?t=CBC.APP.SC.publishedTime:l.scqs.pubdate&&a.test(l.scqs.pubdate)?t=l.scqs.pubdate:void 0!==l.scqs.pubdate&&(t="Incorrect date format received: "+l.scqs.pubdate),e.var13=t}return e},exitSPA:function(){return!(l.pageviewcount=0)},parseKeywords:function(e){var t=0,a=0,r=[];if("object"!==_typeof(e))return"";for(t=0;t<e.length;t++)for(a=0;a<e[t].entities.length;a++)r.push(e[t].name+":"+e[t].entities[a].name);return r.join([","]).toLowerCase().replace(/\s/g,"-")},checkStatsVersions:function(e,t){var a=(e===t)+":"+e+":"+t;return u.prop70=a}}}(),CBC.APP.SC.preventDefault||CBC.APP.SC.DTM.DATA.preventDefault?CBC.APP.SC.UTIL.console("Warning: Not firing page tracking on page load"):CBC.APP.SC.PageTracker.init(),function(){if(document.getElementById("cbc-as-search-root")){var e=document.createElement("link");e.rel="stylesheet",e.id="cbc-as-search-css",e.href="/search-assets/static/css/cbc-as-search.css",document.head.appendChild(e);var t=document.createElement("script");t.type="text/javascript",t.id="cbc-as-search-js",t.src="/search-assets/static/js/cbc-as-search.js",document.body.appendChild(t)}}(),function(r){function e(e,t){var a=window.document.createElement("iframe");a.setAttribute("src","/g/stats/html/cmf.html?a="+e+"&m="+t+"&s=cbc&p="+encodeURIComponent(r.location.href)),a.setAttribute("id","cmf-iframe"),a.setAttribute("width","0"),a.setAttribute("height","0"),a.setAttribute("frameBorder","0"),document.body.appendChild(a)}document.getElementById("cmf-iframe")&&document.getElementById("cmf-iframe").remove();var t,a={"cbc.ca\\/xcompany\\/debriefing":"1415.11316.140589","cbc.ca\\/bellevue\\/videos\\/1994-videos":"1617.11311.146736","cbc.ca\\/kidscbc1\\/shows\\/chirp":"1213.11116.133491","cbc.ca\\/covermecanada":"1112.11416.132002","cbc.ca\\/player\\/tv\\/Halifax%20Comedy%20Festival\\/Season%2019":"1415.11453.141153","cbc.ca\\/kidscbcolympics":"1617.11116.144982","cbc.ca\\/murdochmysteries\\/onthecase":"1516.11316.142584","cbc.ca\\/murdochmysteries\\/noqs":"1213.11316.132929","cbc.ca\\/murdochmysteries\\/videos\\/making-murdoch\\/\\S+":"1314.11313.138117","cbc.ca\\/murdochmysteries\\/theinfernaldevice":"1415.11353.141147","cbc.ca\\/overtherainbow":"1213.11416.133409","cbc.ca\\/republicofdoyle\\/episodes\\/season-5\\/\\S+":"1314.11313.138147","cbc.ca\\/thebestlaidplans\\/videos\\/the-petes-laid-plans\\/\\S+":"1314.11313.138145","cbc.ca\\/22minutes\\/videos\\/22-minutes-update\\/\\S+":"1516.11353.142570","cbc.ca\\/thislife\\/videos\\/exclusives\\/\\S+":"1516.11313.142585","cbc.ca\\/workinmoms\\/videos\\/season-1\\/\\S+":"1617.11353.145375","cbc.ca\\/xcompany\\/videos\\/x-company-animated\\/\\S+":"1516.11313.142581","cbc.ca\\/shootthemessenger\\/murderboard":"1516.11315.142932","cbc.ca\\/arcticair\\/videos\\/man-of-the-north":"1112.11316.131909","cbc.ca\\/michael\\/videos\\/lost-therapy-tapes":"1112.11316.131239","cbc.ca\\/michael\\/videos\\/after-the-beep":"1112.11316.131239","comedycoup.cbc.ca\\/cc\\/canada-2014":"1415.11316.139499","cbc.ca\\/mrd\\/videos\\/xavier-gazette":"1112.11316.131856","cbc.ca\\/insecurity":"1011.11316.128616"};Object.keys(a).some(function(e){return!!new RegExp(e).test(r.location.href)&&(t=a[e],!0)})?e(t,r.document.title):r.CBC.APP.SC.DTM.DATA&&r.CBC.APP.SC.DTM.DATA.cmfAppId&&e(r.CBC.APP.SC.DTM.DATA.cmfAppId,r.CBC.APP.SC.DTM.DATA.title)}(window._window||window);